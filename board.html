<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title></title>
        <script src="https://d3js.org/d3.v5.min.js"></script>
    </head>
    <link rel="stylesheet" href="/stylesheet.css">
    <body>
        <div class="container">
            <div id="messages">
                <p>Player 1 played a red 1</p>
                <p>Player two gave a hint</p>
            </div>
            <div id="useful"></div>
            <div id="hands"></div>
            <div id="useless"></div>
            <div id="main"></div>
        </div>
        <script type="text/javascript">
            const width = 500,
                height = 400
                margin = {top: 20, right: 10, bottom: 20, left: 10};

            const cardHeight = 60
                cardRadius = 5;

            let svgHands = d3.select("div#hands").append("svg")
                // .attr("viewBox", [0, 0, width, height]);
                .attr("width", width)
                .attr("height", height);

            let svgStack = d3.select("div#main").append("svg")
                .attr("width", width)
                .attr("height", 100);

            let svgUseful = d3.select("div#useful").append("svg")
                .attr("width", width)
                .attr("height", height)
            .append("g")
                .attr("class", "useful");

            let svgUseless = d3.select("div#useless").append("svg")
                .attr("width", width)
                .attr("height", height)
            .append("g")
                .attr("class", "useless");


            d3.json("data.json").then(data => {

                let players = data.players;

                let x = d3.scaleBand()
                    .domain([0,1,2,3,4])  // [..."01234"].map(x => +x)
                    .range([margin.left, width - margin.right])
                    .padding(0.6);

                let y = d3.scaleBand()
                    .domain(players.map(d => d.player))  // nb_players
                    .range([margin.top, height - margin.bottom])
                    .padding(0.6);

                players.forEach(d => drawHand(d))
                // drawHand(players.filter(d => d.player === 1)[0])
                // drawHand(players.filter(d => d.player === 2)[0])

                let xx = d3.scaleBand()
                    .domain(["red", "blue", "green", "yellow", "white"])
                    .range([margin.left, width - margin.right])
                    .padding(0.6);

                let yy = d3.scaleBand()
                    .domain([1, 2, 3, 4, 5])  // nb_players
                    .range([margin.top, height - margin.bottom])
                    .padding(0.6);

                drawPlayed(data.played);
                drawDiscarded(svgUseful, data.discardedUseful)
                drawDiscarded(svgUseless, data.discardedUseless)


                function drawHand(player) {
                    let g = svgHands.append("g").attr("class", "hand");

                    g.selectAll("rect")
                        .data(player.hand)
                        .enter()
                        .append("rect")
                            .attr("x", (_, i) => x(i))
                            .attr("y", y(player.player))
                            .attr("width", x.bandwidth())
                            .attr("height", cardHeight)
                            .attr("rx", cardRadius)
                            .attr("class", "card-visible");

                    g.selectAll("text")
                        .data(player.hand)
                        .enter()
                        .append("text")
                            .attr("x", (_, i) => x(i) + x.bandwidth()/2)
                            .attr("y", y(player.player) + cardHeight/2)
                            .attr("dy", "0.4em")
                            .text(d => d.number)
                            .style("fill", d => d.colour)
                            .attr("class", "card-text");
                }

                function drawPlayed(played) {
                    let g = svgStack.append("g").attr("class", "main");

                    g.selectAll("rect")
                        .data(played)
                        .enter()
                        .append("rect")
                            .attr("x", d => xx(d.colour))
                            .attr("y", margin.top)
                            .attr("width", xx.bandwidth())
                            .attr("height", cardHeight)
                            .attr("rx", cardRadius)
                            .attr("class", "card-visible");

                    g.selectAll("text")
                        .data(played)
                        .enter()
                        .append("text")
                            .attr("x", d => xx(d.colour) + xx.bandwidth()/2)
                            .attr("y", margin.top + cardHeight/2)
                            .attr("dy", "0.4em")
                            .text(d => d.number)
                            .style("fill", d => d.colour)
                            .attr("class", "card-text");
                }

                function drawDiscarded(g, played) {
                    g.selectAll("rect")
                        .data(played)
                        .enter()
                        .append("rect")
                            .attr("x", d => xx(d.colour))
                            .attr("y", d => yy(d.number))
                            .attr("width", xx.bandwidth())
                            .attr("height", cardHeight)
                            .attr("rx", cardRadius)
                            .attr("class", "card-visible");

                    g.selectAll("text")
                        .data(played)
                        .enter()
                        .append("text")
                            .attr("x", d => xx(d.colour) + xx.bandwidth()/2)
                            .attr("y", d => yy(d.number) + cardHeight/2)
                            .attr("dy", "0.4em")
                            .text(d => d.number)
                            .style("fill", d => d.colour)
                            .attr("class", "card-text");
                }
            })
        </script>
    </body>
</html>
